<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>高機能！席替えアプリ 説明書</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Hiragino Kaku Gothic ProN", "Hiragino Sans", Meiryo, sans-serif;
            line-height: 1.8;
            color: #333;
            background-color: #f9f9f9;
            margin: 0;
            padding: 0;
        }
        .container {
            max-width: 800px;
            margin: 2em auto;
            padding: 2em;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }
        h1, h2, h3 {
            font-weight: 600;
            margin-top: 2em;
            margin-bottom: 1em;
            padding-bottom: 0.3em;
            border-bottom: 1px solid #eee;
        }
        h1 {
            text-align: center;
            border-bottom: 2px solid #4a90e2;
            font-size: 2em;
        }
        h2 {
            font-size: 1.6em;
            border-bottom: 2px solid #ddd;
        }
        h3 {
            font-size: 1.3em;
            border-bottom: 1px dashed #ddd;
        }
        p {
            margin-bottom: 1em;
        }
        ol, ul {
            padding-left: 2em;
        }
        li {
            margin-bottom: 0.8em;
        }
        strong, b {
            color: #d9534f; /* 強調したい文字を赤系に */
            font-weight: bold;
        }
        code {
            font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace;
            background-color: #f0f0f0;
            padding: 0.2em 0.4em;
            border-radius: 3px;
            font-size: 0.9em;
        }
        .note {
            background-color: #fffbe6;
            border: 1px solid #ffe58f;
            border-radius: 4px;
            padding: 1em;
            margin: 1em 0;
        }
        .note strong {
            color: #c47d00;
        }
        .copyright {
            margin-top: 3em;
            padding-top: 1em;
            border-top: 1px solid #eee;
            font-size: 0.8em;
            color: #777;
            text-align: center;
        }
        a {
            color: #4a90e2;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
        /* 音声プレーヤーのスタイル */
        .audio-container {
            margin: 1.5em auto;
            text-align: center;
            padding: 1em;
            background-color: #eef;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        /* シートコピーリンクのスタイル */
        .sheet-link-container {
            margin: 1.5em auto;
            text-align: center;
            padding: 1.2em;
            background-color: #e6ffe6; /* 薄い緑色 */
            border: 1px solid #8fcf8f;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .sheet-link-container a {
            font-size: 1.2em;
            font-weight: bold;
            color: #28a745; /* 強めの緑色 */
            text-decoration: none;
        }
        .sheet-link-container a:hover {
            text-decoration: underline;
        }
        /* コードダウンロードリンクのスタイル */
        .code-link-container {
            margin: 2em auto;
            text-align: center;
            padding: 1.5em;
            background-color: #e0f2f7; /* 薄い青色 */
            border: 1px solid #6dd5ed;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.08);
        }
        .code-link-container a {
            font-size: 1.3em;
            font-weight: bold;
            color: #007bff; /* 青色 */
            text-decoration: none;
            display: inline-block; /* ボタンのように見せるため */
            padding: 0.8em 1.5em;
            border: 2px solid #007bff;
            border-radius: 5px;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        .code-link-container a:hover {
            background-color: #007bff;
            color: #fff;
            text-decoration: none;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>高機能！席替えアプリ 説明書 (詳細版)</h1>
        <p>この説明書は、Googleスプレッドシートをコピーして、あなただけの「席替えアプリ」を準備し、実際に使うまでの手順を詳しく解説します。画像がなくても分かるように、一つ一つの操作を丁寧にご案内します。</p>

        <div class="audio-container">
            <p><strong>音声ガイド: アプリの準備と操作の概要</strong></p>
            <audio controls>
                <source src="voice/ChangeSeatsVoiceGuide.m4a" type="audio/mp4">
                <p>お使いのブラウザは音声要素をサポートしていません。</p>
            </audio>
        </div>

        <div class="sheet-link-container">
            <p><strong>ここから席替えアプリのテンプレートシートをコピーできます:</strong></p>
            <a href="https://bit.ly/changing_seats" target="_blank" rel="noopener noreferrer">
                席替えアプリ テンプレートシートをコピーする
            </a>
            <p style="font-size: 0.9em; color: #555; margin-top: 0.5em;">（クリックするとGoogleドライブにシートがコピーされます）</p>
        </div>

        <h2>もくじ</h2>
        <ul>
            <li><a href="#prep">1. 【準備編】 アプリを自分のGoogleアカウントで使えるようにする（初回のみ）</a></li>
            <li><a href="#basic">2. 【基本操作編】 実際に席替えをする</a></li>
            <li><a href="#advanced">3. 【便利機能編】 アプリをさらに使いこなす</a></li>
        </ul>

        <h2 id="prep">1. 【準備編】 アプリを自分のGoogleアカウントで使えるようにする（初回のみ）</h2>
        <p>この準備作業は、<strong>一番最初に一度だけ</strong>行えばOKです。</p>

        <h3 id="prep-step1">STEP 1: テンプレートのスプレッドシートを自分のGoogleドライブにコピーする</h3>
        <ol>
            <li>配布された<strong>テンプレートのリンク</strong>をブラウザで開きます。</li>
            <li>画面の中央に「ドキュメントをコピーしますか？」というメッセージが表示されます。</li>
            <li>右上に表示されている青い <strong>[コピーを作成]</strong> という四角いボタンをクリックします。</li>
            <li>自動的にあなたのGoogleドライブにファイルがコピーされ、スプレッドシートの画面が開きます。ファイル名は何でも構いません。</li>
        </ol>

        <h3 id="prep-step2">STEP 2: アプリを「デプロイ」してインターネット上で使えるようにする</h3>
        <p>「デプロイ」とは、設計図（プログラム）から実際に動くアプリをインターネット上に作り出す作業のことです。少し手順が多いですが、この通りに進めれば大丈夫です。</p>
        <ol>
            <li>スプレッドシート画面の上部にあるメニュー（「ファイル」「編集」「表示」などが並んでいるところ）から、<strong>[拡張機能]</strong> をクリックします。</li>
            <li>出てきたメニューの中から <strong>[Apps Script]</strong> を選択します。</li>
            <li>プログラムが書かれた新しいタブ（またはウィンドウ）が開きます。</li>
            <li>画面の右上にある、青くて四角い <strong>[デプロイ]</strong> ボタンをクリックします。</li>
            <li>出てきたメニューの中から <strong>[新しいデプロイ]</strong> を選択します。</li>
            <li>新しいウィンドウが開きます。左上にある<strong>歯車のアイコン⚙</strong>（「種類の選択」の横）をクリックします。</li>
            <li>出てきたリストの中から <strong>[ウェブアプリ]</strong> をクリックして選択します。</li>
            <li>設定項目がいくつか表示されます。その中から<strong>「アクセスできるユーザー」</strong>という項目を探してください。</li>
            <li>初期設定では「自分のみ」になっています。この部分をクリックし、選択肢の中から <strong>[全員]</strong> を選びます。
                <div class="note"><strong>ご安心ください：</strong> これを選択しても、あなたのGoogleアカウントの情報や他のファイルが誰かに見られることはありません。アプリのURLを知っている人だけがアクセスできる、という意味です。</div>
            </li>
            <li>画面右下の青い <strong>[デプロイ]</strong> ボタンをクリックします。</li>
            <li>「承認が必要です」というメッセージが表示されたら、青い <strong>[アクセスを承認]</strong> ボタンをクリックします。</li>
            <li>「Googleにログイン」というウィンドウが開くので、<strong>あなた自身のGoogleアカウント</strong>を選択します。</li>
            <li>「このアプリは Google で確認されていません」という警告画面が表示されることがあります。これは自作のプログラムを動かす際の通常の表示です。
                <div class="note">
                    <p>画面の左下にある青い文字の <strong>[詳細]</strong> をクリックします。</p>
                    <p>表示が下に広がり、一番下に<strong>「（安全でないページ）に移動」</strong>というリンクが表示されるので、それをクリックします。</p>
                </div>
            </li>
            <li>「このアプリにアカウントへのアクセスをリクエストしています」という画面が表示されたら、右下の青い <strong>[許可]</strong> ボタンをクリックします。</li>
        </ol>

        <h3 id="prep-step3">STEP 3: あなた専用のアプリのURLをいつでも開けるように保存する</h3>
        <ol>
            <li>「デプロイが正常に更新されました」という画面が表示され、その中に<strong>ウェブアプリのURL</strong>（<code>https://script.google.com/...</code>で始まる長いアドレス）が表示されます。</li>
            <li>このURLの右側にある <strong>[コピー]</strong> ボタンをクリックします。</li>
            <li>コピーしたURLを、お使いのブラウザの<strong>ブックマーク（お気に入り）に登録</strong>してください。
                <p>次回からは、このブックマークをクリックするだけで、いつでもあなたの席替えアプリを開くことができます。</p>
            </li>
            <li>右下の <strong>[完了]</strong> ボタンを押し、開いているプログラムの画面やスプレッドシートはすべて閉じてしまって構いません。</li>
        </ol>
        <p><strong>お疲れ様でした！これで準備は完了です。</strong></p>
        
        <h2 id="basic">2. 【基本操作編】 実際に席替えをする</h2>
        <p>ブックマークしたURLを開いて、アプリの画面で操作します。</p>

        <h3>STEP 1: 生徒の名簿を用意する（3つの方法）</h3>
        <p>アプリ画面の左側「生徒リスト」エリアで操作します。</p>
        <ul>
            <li><strong>方法①：手で一人ずつ入力する</strong>
                <ol>
                    <li>「生徒の名前」と書かれた入力欄に、生徒の名前を一人入力します。</li>
                    <li>右隣の青い <strong>[追加]</strong> ボタンを押します。</li>
                    <li>リストに追加されたことを確認し、これを繰り返します。</li>
                </ol>
            </li>
            <li><strong>方法②：スプレッドシートの名簿から一括で読み込む</strong>
                <ol>
                    <li>青みがかった <strong>[シートから読込]</strong> ボタンを押します。</li>
                    <li>あなたのGoogleスプレッドシートに自動作成された「名簿」シートから、名前のリストを一括で読み込みます。</li>
                    <li>（ポイント：「名簿」シートのA列に名前を書いておけば、それが読み込まれます。）</li>
                </ol>
            </li>
            <li><strong>方法③：CSVファイルを使って読み込む</strong>
                <ol>
                    <li>もしExcelなどで作った名簿ファイル（CSV形式）があれば、灰色の <strong>[CSVインポート]</strong> ボタンを押して、そのファイルを選択します。</li>
                    <li>CSVファイルの作り方が分からない場合は、緑色の <strong>[サンプルCSV]</strong> ボタンを押すと、見本となるファイルがダウンロードできます。</li>
                </ol>
            </li>
        </ul>

        <h3>STEP 2: 教室の座席レイアウトを作成する</h3>
        <p>アプリ画面の中央「座席レイアウト」エリアで操作します。</p>
        <ul>
            <li><strong>座席を一つ作る：</strong> 緑色の <strong>[座席を追加]</strong> ボタンを押します。</li>
            <li><strong>座席をまとめて作る：</strong> 「複数追加」の横にある<strong>数字の入力欄</strong>に作りたい座席数を入力し、右隣の緑色のボタンを押します。</li>
            <li><strong>座席をきれいに並べる：</strong> <strong>「グリッド配置」</strong>などを選び、右隣の緑色の <strong>[配置]</strong> ボタンを押すと、座席が自動で整列します。</li>
            <li><strong>座席を手で動かす：</strong> 各座席は、マウスでクリックしたまま好きな場所へ動かす（ドラッグ＆ドロップ）ことができます。</li>
        </ul>
        
        <h3>STEP 3: 席替えを実行し、結果をスプレッドシートに出力する</h3>
        <ol>
            <li>名簿と座席の準備ができたら、青い <strong>[席替え実行]</strong> ボタンを押します。座席に生徒の名前が自動で割り振られます。</li>
            <li>結果に満足したら、緑色の <strong>[シートに出力]</strong> ボタンを押します。</li>
            <li>「〜に出力しました！」というメッセージが出たら、あなたのGoogleスプレッドシートを開いて確認してください。新しいシートが追加され、レイアウトがそのままの形で出力されています。このシートは印刷や共有に便利です。</li>
        </ol>

        <h2 id="advanced">3. 【便利機能編】 アプリをさらに使いこなす</h2>
        
        <h3>機能1: 隣に座らせたくない生徒を指定する（隣席制約）</h3>
        <ol>
            <li>左側の「隣席制約」エリアにある、上の選択ボックスで一人目の生徒を選びます。</li>
            <li>下の選択ボックスで二人目の生徒を選びます。</li>
            <li>青い <strong>[制約を追加]</strong> ボタンを押します。</li>
            <li>リストに追加されたペアは、「席替え実行」時に隣同士になりません。</li>
        </ol>

        <h3>機能2: 特定の生徒を席替えで動かさないようにする（座席ロック）</h3>
        <ol>
            <li>席替えで動かしたくない生徒が座っている座席を見つけます。</li>
            <li>座席の左上に表示されている<strong>鍵のアイコン🔓</strong>をクリックします。</li>
            <li>アイコンが<strong>閉じた鍵🔒</strong>に変わり、座席の枠が<strong>紫色</strong>になればロック完了です。</li>
            <li>この状態で「席替え実行」すると、ロックされた生徒はその場から動きません。解除するには、もう一度鍵のアイコンをクリックします。</li>
        </ol>

        <h3>機能3: 作成したレイアウトを保存・復元する（データ保存・読み込み）</h3>
        <p>生徒リスト、座席の配置、制約、ロック状態など、<strong>現在のすべての設定</strong>を一つのファイルとしてあなたのパソコンに保存できます。</p>
        <ul>
            <li><strong>保存する時：</strong> 左下の <strong>[保存]</strong> ボタンを押します。</li>
            <li><strong>復元する時：</strong> <strong>[読み込み]</strong> ボタンを押し、以前保存したファイルを選択します。</li>
        </ul>

        <h3>機能4: 座席の表示サイズを調整する</h3>
        <p>座席の数が多くて見づらい時などに使います。</p>
        <ul>
            <li><strong>自動で調整（初期設定）：</strong> 「自動サイズ調整」のチェックボックスにチェックが入っている状態です。座席の数に応じてアプリが見やすいサイズに自動で変更します。</li>
            <li><strong>手で調整：</strong> 「自動サイズ調整」のチェックを外すと、右側の<strong>スライダー</strong>や<strong>数字の入力欄</strong>が操作できるようになり、好きなサイズに変更できます。</li>
        </ul>
        
        <div class="code-link-container">
            <p><strong>このアプリのコードはGitHubで公開されています。自由にダウンロードして改変できます:</strong></p>
            <a href="https://github.com/JohnnyMaeda/changing_seats/tree/main/code" target="_blank" rel="noopener noreferrer">
                GitHubでコードをダウンロード・改変する
            </a>
            <p style="font-size: 0.9em; color: #555; margin-top: 0.8em;">（MITライセンスのもと、自由に利用可能です）</p>
        </div>

        <div class="copyright">
            <p><strong>著作権表示 (Copyright)</strong></p>
            <p>Copyright (c) 2025 Maeta Masaaki. This software is released under the MIT License.</p>
            <p>改変は自由ですが、本ソフトウェアの使用によって生じた問題については、作者は一切の責任を負いません。</p>
        </div>
    </div>

</body>
</html>
